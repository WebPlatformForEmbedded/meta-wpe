# Provides the WPE Streamer plugin, it support Aamp, CENC and QAM based streaming
WPE_STREAMER_AUTOSTART ??= "true"
WPE_STREAMER_DECODERS ??= "2"

# AAMP variables
WPE_AAMP_STREAMER_FRONTENDS ??= "0"
WPE_AAMP_STREAMER_WESTEROSSINK ??= "${@bb.utils.contains('DISTRO_FEATURES', 'wayland', 'ON', 'OFF', d)}"

# QAM variables, adjust to your own need in your adaptation/local.conf
WPE_QAM_STREAMER_BROADCAST_STANDARD ??= "DVB"
WPE_QAM_STREAMER_BROADCAST_HOME_TS ??= ""
WPE_QAM_STREAMER_BROADCAST_SI_PARSING ??= "false"
WPE_QAM_STREAMER_BROADCAST_TS_SCANNING ??= "OFF"
WPE_QAM_STREAMER_BROADCAST_CABLE_ANNEX ??= "B"
WPE_QAM_STREAMER_BROADCAST_CABLE_FRONTENDS ??= "1"
WPE_QAM_STREAMER_BROADCAST_SATELLITE_ANNEX ??= ""
WPE_QAM_STREAMER_BROADCAST_SATELLITE_FRONTENDS ??= "1"
WPE_QAM_STREAMER_BROADCAST_TERRESTRIAL_ANNEX ??= ""
WPE_QAM_STREAMER_BROADCAST_TERRESTRIAL_FRONTENDS ??= "1"
WPE_QAM_STREAMER_DEPENDENCIES ??= "wpeframework-libraries"

WPE_STREAMER_IMPLEMENTATIONS = "${@bb.utils.contains('PACKAGECONFIG', 'streamer_aamp', 'Aamp', '', d)}"
WPE_STREAMER_IMPLEMENTATIONS += "${@bb.utils.contains('PACKAGECONFIG', 'streamer_cenc', 'CENC', '', d)}"
WPE_STREAMER_IMPLEMENTATIONS += "${@bb.utils.contains('PACKAGECONFIG', 'streamer_qam', 'QAM', '', d)}"

PACKAGECONFIG[streamer] = "\
    -DPLUGIN_STREAMER=ON \
    -DPLUGIN_STREAMER_IMPLEMENTATIONS="${WPE_STREAMER_IMPLEMENTATIONS}" \
    -DPLUGIN_STREAMER_DECODERS="${WPE_STREAMER_DECODERS}" \
    ,-DPLUGIN_STREAMER=OFF,, \
"

PACKAGECONFIG[streamer_aamp] = "\
    -DPLUGIN_STREAMER_AAMP_FRONTENDS=${WPE_AAMP_STREAMER_FRONTENDS} \
    -DPLUGIN_STREAMER_AAMP_WESTEROSSINK=${WPE_AAMP_STREAMER_WESTEROSSINK} \
    ,,gst-plugins-rdk-aamp \
"

PACKAGECONFIG[streamer_cenc] = "\
    ,,gstreamer1.0-plugins-cencdecrypt gstreamer1.0 gstreamer1.0-plugins-base gstreamer1.0-plugins-good \
"

PACKAGECONFIG[streamer_qam] = "\
    -DPLUGIN_STREAMER_FRONTENDS="${WPE_QAM_STREAMER_FRONTENDS}" \
    -DPLUGIN_STREAMER_BROADCAST_HOME_TS="${WPE_QAM_STREAMER_BROADCAST_HOME_TS}" \
    -DPLUGIN_STREAMER_BROADCAST_SI_PARSING="${WPE_QAM_STREAMER_BROADCAST_SI_PARSING}" \
    -DPLUGIN_STREAMER_BROADCAST_STANDARD="${WPE_QAM_STREAMER_BROADCAST_STANDARD}" \
    -DPLUGIN_STREAMER_BROADCAST_TS_SCANNING="${WPE_QAM_STREAMER_BROADCAST_TS_SCANNING}" \
    ,${WPE_QAM_STREAMER_DEPENDENCIES}, \
"
PACKAGECONFIG[streamer_qam_cable] = "\
    -DPLUGIN_STREAMER_BROADCAST_CABLE=ON \
    -DPLUGIN_STREAMER_BROADCAST_CABLE_ANNEX="${WPE_QAM_STREAMER_BROADCAST_CABLE_ANNEX}" \
    -DPLUGIN_STREAMER_BROADCAST_CABLE_FRONTENDS="${WPE_QAM_STREAMER_BROADCAST_CABLE_FRONTENDS" \
    ,, \
"
PACKAGECONFIG[streamer_qam_satellite] = "\
    -DPLUGIN_STREAMER_BROADCAST_SATELLITE=ON \
    -DPLUGIN_STREAMER_BROADCAST_SATELLITE_ANNEX="${WPE_QAM_STREAMER_BROADCAST_SATELLITE_ANNEX}" \
    -DPLUGIN_STREAMER_BROADCAST_SATELLITE_FRONTENDS="${WPE_QAM_STREAMER_BROADCAST_SATELLITE_FRONTENDS" \
    ,, \
"
PACKAGECONFIG[streamer_qam_terrestrial] = "\
    -DPLUGIN_STREAMER_BROADCAST_TERRESTRIAL=ON \
    -DPLUGIN_STREAMER_BROADCAST_TERRESTRIAL_ANNEX="${WPE_QAM_STREAMER_BROADCAST_TERRESTRIAL_ANNEX}" \
    -DPLUGIN_STREAMER_BROADCAST_TERRESTRIAL_FRONTENDS="${WPE_QAM_STREAMER_BROADCAST_TERRESTRIAL_FRONTENDS" \
    ,, \
"

