# Provides configuration for the RemoteControl Plugin

WPE_REMOTECONTROL_AUTOSTART ??= "true"
WPE_REMOTECONTROL_PASSON ??= "false"
WPE_REMOTECONTROL_RELEASE_TIMEOUT ??= "30000"
WPE_REMOTECONTROL_POSTLOOKUP_FILE ??= ""
WPE_REMOTECONTROL_POSTLOOKUP_MAPFILE ??= ""
WPE_REMOTECONTROL_POSTLOOKUP_CALLSIGN ??= ""
WPE_REMOTECONTROL_CUSTOM_VIRTUAL_NAME ??= ""
WPE_REMOTECONTROL_CUSTOM_VIRTUAL_MAP_FILE ??= ""
WPE_REMOTECONTROL_REPEAT_INTERVAL ??= "100"
WPE_REMOTECONTROL_REPEAT_START ??= "500"
WPE_REMOTECONTROL_CEC ??= "OFF"

# Configuration for RF4CE remote
WPE_REMOTECONTROL_RF4CE_REMOTE_ID ??= "GPSTB"
WPE_REMOTECONTROL_RF4CE_MODULE ??= "/lib/modules/gpK5.ko"
WPE_REMOTECONTROL_RF4CE_NODE_ID ??= "249"
WPE_REMOTECONTROL_RFCE_AUTOPAIRING ??= "false"
WPE_REMOTECONTROL_RFCE_NVM_LUT ??= "DEFAULT"
WPE_REMOTECONTROL_RF4CE_DEPENDENCY ??= "rf4ce-hal-gp"

PACKAGECONFIG[remote] = "\
    -DPLUGIN_REMOTECONTROL=ON \
    -DPLUGIN_REMOTECONTROL_AUTOSTART="${WPE_REMOTECONTROL_AUTOSTART}" \
    -DPLUGIN_REMOTECONTROL_REPEAT_INTERVAL="${WPE_REMOTECONTROL_REPEAT_INTERVAL}" \
    -DPLUGIN_REMOTECONTROL_REPEAT_START="${WPE_REMOTECONTROL_REPEAT_START}" \
    -DPLUGIN_REMOTECONTROL_PASSON="${WPE_REMOTECONTROL_PASSON}" \
    -DPLUGIN_REMOTECONTROL_RELEASE_TIMEOUT="${WPE_REMOTECONTROL_RELEASE_TIMEOUT}" \
    -DPLUGIN_REMOTECONTROL_POSTLOOKUP_FILE="${WPE_REMOTECONTROL_POSTLOOKUP_FILE}" \
    -DPLUGIN_REMOTECONTROL_POSTLOOKUP_MAPFILE="${WPE_REMOTECONTROL_POSTLOOKUP_MAPFILE}" \
    -DPLUGIN_REMOTECONTROL_POSTLOOKUP_CALLSIGN="${WPE_REMOTECONTROL_POSTLOOKUP_CALLSIGN}" \
    -DPLUGIN_REMOTECONTROL_CEC="{WPE_REMOTECONTROL_CEC}" \
    -DPLUGIN_REMOTECONTROL_CUSTOM_VIRTUAL_NAME="${WPE_REMOTECONTROL_CUSTOM_VIRTUAL_NAME}" \
    -DPLUGIN_REMOTECONTROL_CUSTOM_VIRTUAL_MAP_FILE="${WPE_REMOTECONTROL_CUSTOM_VIRTUAL_MAP_FILE}" \
    ,-DPLUGIN_REMOTECONTROL=OFF, \
"

PACKAGECONFIG[remote-devinput] = "-DPLUGIN_REMOTECONTROL_DEVINPUT=ON,-DPLUGIN_REMOTECONTROL_DEVINPUT=OFF,"

PACKAGECONFIG[remote-gp] = "\
    -DPLUGIN_REMOTECONTROL_RFCE=ON \
    -DPLUGIN_REMOTECONTROL_RFCE_REMOTE_ID=${WPE_REMOTECONTROL_RF4CE_REMOTE_ID} \
    -DPLUGIN_REMOTECONTROL_RFCE_MODULE=${WPE_REMOTECONTROL_RF4CE_MODULE} \
    -DPLUGIN_REMOTECONTROL_RFCE_NODE_ID=${WPE_REMOTECONTROL_RF4CE_NODE_ID} \
    -DPLUGIN_REMOTECONTROL_RFCE_AUTOPAIRING=${WPE_REMOTECONTROL_RFCE_AUTOPAIRING} \
    -DPLUGIN_REMOTECONTROL_RFCE_NVM_LUT=${WPE_REMOTECONTROL_RFCE_NVM_LUT} \
    ,-DPLUGIN_REMOTECONTROL_RFCE=OFF,${WPE_REMOTECONTROL_RF4CE_DEPENDENCY} \
"

do_install:append() {
    if ${@bb.utils.contains("PACKAGECONFIG", "remote-devinput", "true", "false", d)}
    then
      cp -av --no-preserve=ownership ${WORKDIR}/osmc-devinput-remote.json ${D}${datadir}/WPEFramework/RemoteControl/devinput-remote.json
    fi
}

FILES:${PN} += "${@bb.utils.contains('PACKAGECONFIG', 'remote-devinput', '${datadir}/WPEFramework/RemoteControl/devinput-remote.json', '', d)}"

